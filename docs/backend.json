{
  "entities": {
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Represents an administrator account.",
      "properties": {
        "adminId": {
          "type": "string",
          "description": "Unique identifier for the admin user."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the admin account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "adminId",
        "createdAt"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "fullName": {
          "type": "string",
          "description": "The user's full name."
        },
        "usn": {
          "type": "string",
          "description": "The user's University Student Number (USN)."
        },
        "verificationStatus": {
          "type": "string",
          "description": "The verification status of the user (pending, approved, rejected)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "userId",
        "fullName",
        "usn",
        "verificationStatus",
        "createdAt"
      ]
    },
    "IDVerification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "IDVerification",
      "type": "object",
      "description": "Represents the ID verification information for a user.",
      "properties": {
        "verificationId": {
          "type": "string",
          "description": "Unique identifier for the ID verification record."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 IDVerification)"
        },
        "idCardImageURL": {
          "type": "string",
          "description": "URL of the uploaded ID card image.",
          "format": "uri"
        },
        "verificationStatus": {
          "type": "string",
          "description": "The verification status (pending, approved, rejected)."
        },
        "verifiedBy": {
          "type": "string",
          "description": "Reference to Admin. (Relationship: Admin 1:N IDVerification) The admin who verified the ID."
        },
        "verifiedAt": {
          "type": "string",
          "description": "Timestamp indicating when the ID was verified.",
          "format": "date-time"
        }
      },
      "required": [
        "verificationId",
        "userId",
        "idCardImageURL",
        "verificationStatus",
        "verifiedBy",
        "verifiedAt"
      ]
    },
    "Post": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Post",
      "type": "object",
      "description": "Represents a lost or found item post.",
      "properties": {
        "postId": {
          "type": "string",
          "description": "Unique identifier for the post."
        },
        "postType": {
          "type": "string",
          "description": "The type of post (lost or found)."
        },
        "title": {
          "type": "string",
          "description": "The title of the post."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the item and circumstances."
        },
        "location": {
          "type": "string",
          "description": "The location where the item was lost or found."
        },
        "date": {
          "type": "string",
          "description": "The date the item was lost or found.",
          "format": "date-time"
        },
        "itemImageURL": {
          "type": "string",
          "description": "URL of the image associated with the item.",
          "format": "uri"
        },
        "postedBy": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Post) The user who created the post."
        },
        "postedByName": {
          "type": "string",
          "description": "The full name of the user who posted the item."
        },
        "status": {
          "type": "string",
          "description": "The status of the post (open or resolved)."
        },
        "replyCount": {
          "type": "number",
          "description": "The number of replies on the post."
        },
        "expiresAt": {
          "type": "string",
          "description": "Timestamp indicating when the post expires.",
          "format": "date-time"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the post was created.",
          "format": "date-time"
        }
      },
      "required": [
        "postId",
        "postType",
        "title",
        "description",
        "location",
        "date",
        "postedBy",
        "postedByName",
        "status",
        "replyCount",
        "expiresAt",
        "createdAt"
      ]
    },
    "Reply": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Reply",
      "type": "object",
      "description": "Represents a reply to a post.",
      "properties": {
        "replyId": {
          "type": "string",
          "description": "Unique identifier for the reply."
        },
        "postId": {
          "type": "string",
          "description": "Reference to Post. (Relationship: Post 1:N Reply) The post to which the reply belongs."
        },
        "repliedBy": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Reply) The user who created the reply."
        },
        "repliedByName": {
          "type": "string",
          "description": "The full name of the user who created the reply."
        },
        "message": {
          "type": "string",
          "description": "The content of the reply."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the reply was created.",
          "format": "date-time"
        }
      },
      "required": [
        "replyId",
        "postId",
        "repliedBy",
        "repliedByName",
        "message",
        "createdAt"
      ]
    },
    "Chat": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Chat",
      "type": "object",
      "description": "Represents a chat between two users related to a post.",
      "properties": {
        "chatId": {
          "type": "string",
          "description": "Unique identifier for the chat."
        },
        "postId": {
          "type": "string",
          "description": "Reference to Post. (Relationship: Post 1:1 Chat) The post to which the chat is related."
        },
        "userAId": {
          "type": "string",
          "description": "Reference to User. The ID of the first user in the chat."
        },
        "userAName": {
          "type": "string",
          "description": "The name of the first user in the chat."
        },
        "userBId": {
          "type": "string",
          "description": "Reference to User. The ID of the second user in the chat."
        },
        "userBName": {
          "type": "string",
          "description": "The name of the second user in the chat."
        }
      },
      "required": [
        "chatId",
        "postId",
        "userAId",
        "userAName",
        "userBId",
        "userBName"
      ]
    },
    "Message": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Message",
      "type": "object",
      "description": "Represents a single message within a chat.",
      "properties": {
        "messageId": {
          "type": "string",
          "description": "Unique identifier for the message."
        },
        "chatId": {
          "type": "string",
          "description": "Reference to Chat. (Relationship: Chat 1:N Message) The chat to which the message belongs."
        },
        "senderId": {
          "type": "string",
          "description": "Reference to User. The ID of the user who sent the message."
        },
        "senderName": {
          "type": "string",
          "description": "The name of the user who sent the message."
        },
        "text": {
          "type": "string",
          "description": "The text content of the message."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the message was sent.",
          "format": "date-time"
        }
      },
      "required": [
        "messageId",
        "chatId",
        "senderId",
        "senderName",
        "text",
        "timestamp"
      ]
    },
    "Notification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Notification",
      "type": "object",
      "description": "Represents a notification for a user.",
      "properties": {
        "notificationId": {
          "type": "string",
          "description": "Unique identifier for the notification."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Notification) The user to whom the notification is directed."
        },
        "type": {
          "type": "string",
          "description": "The type of notification (reply, message, approval)."
        },
        "content": {
          "type": "string",
          "description": "The content of the notification."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the notification was created.",
          "format": "date-time"
        },
        "readStatus": {
          "type": "boolean",
          "description": "Indicates whether the notification has been read."
        }
      },
      "required": [
        "notificationId",
        "userId",
        "type",
        "content",
        "createdAt",
        "readStatus"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/admins/{adminId}",
        "definition": {
          "entityName": "Admin",
          "schema": {
            "$ref": "#/backend/entities/Admin"
          },
          "description": "Stores admin user accounts. Admin access is granted based on the existence of a document in this collection.",
          "params": [
            {
              "name": "adminId",
              "description": "The unique identifier of the admin."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user account information. Contains public user data (fullName) and private data (usn).",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/idVerifications/{verificationId}",
        "definition": {
          "entityName": "IDVerification",
          "schema": {
            "$ref": "#/backend/entities/IDVerification"
          },
          "description": "Stores ID verification information. This collection is only accessible by admins.",
          "params": [
            {
              "name": "verificationId",
              "description": "The unique identifier for the ID verification record."
            }
          ]
        }
      },
      {
        "path": "/posts/{postId}",
        "definition": {
          "entityName": "Post",
          "schema": {
            "$ref": "#/backend/entities/Post"
          },
          "description": "Stores lost and found posts. Includes denormalized 'postedBy' and 'postedByName' for authorization independence.",
          "params": [
            {
              "name": "postId",
              "description": "The unique identifier of the post."
            }
          ]
        }
      },
      {
        "path": "/posts/{postId}/replies/{replyId}",
        "definition": {
          "entityName": "Reply",
          "schema": {
            "$ref": "#/backend/entities/Reply"
          },
          "description": "Stores replies to posts. Includes denormalized 'repliedBy' and 'repliedByName' for authorization independence.",
          "params": [
            {
              "name": "postId",
              "description": "The unique identifier of the parent post."
            },
            {
              "name": "replyId",
              "description": "The unique identifier of the reply."
            }
          ]
        }
      },
      {
        "path": "/chats/{chatId}",
        "definition": {
          "entityName": "Chat",
          "schema": {
            "$ref": "#/backend/entities/Chat"
          },
          "description": "Stores chat information related to posts. Includes denormalized 'userAId', 'userAName', 'userBId', and 'userBName' for authorization independence.",
          "params": [
            {
              "name": "chatId",
              "description": "The unique identifier of the chat."
            }
          ]
        }
      },
      {
        "path": "/chats/{chatId}/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": {
            "$ref": "#/backend/entities/Message"
          },
          "description": "Stores messages within a chat.",
          "params": [
            {
              "name": "chatId",
              "description": "The unique identifier of the parent chat."
            },
            {
              "name": "messageId",
              "description": "The unique identifier of the message."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/notifications/{notificationId}",
        "definition": {
          "entityName": "Notification",
          "schema": {
            "$ref": "#/backend/entities/Notification"
          },
          "description": "Stores notifications for users.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "notificationId",
              "description": "The unique identifier of the notification."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support the CampusFind application, a Lost and Found platform for college students, emphasizing security, scalability, and clear authorization. Key design principles include Authorization Independence, Structural Segregation, and standardized Access Modeling.\n\n**Authorization Independence:**  Denormalization is used to avoid `get()` calls in security rules. The `Post` entity includes `postedBy` and `postedByName`, while `Reply` includes `repliedBy` and `repliedByName`, eliminating the need to fetch user data during authorization. The membership map on chats is achieved via denormalization of `userAId`, `userAName`, `userBId`, and `userBName`.\n\n**Structural Segregation:**  User data and admin data are stored in separate collections (`/users` and `/admins`) to maintain distinct security postures.  Posts are stored in a top-level `/posts` collection, simplifying queries and access rules.\n\n**Access Modeling:** Path-based ownership is used for user-related data, like notifications (`/users/{userId}/notifications/{notificationId}`).  Collaborative data (chats) leverage denormalized fields.  Admin roles are managed through the existence of documents in the `/admins/{adminId}` collection.\n\n**QAPs Support:**\n\n*   **Secure List Operations:** The segregation of data into distinct collections based on access requirements (e.g., `/users`, `/posts`, `/admins`) allows for secure list operations. Rules can be applied at the collection level without needing to filter based on document content.\n*   **Admin Verification:** The `/idVerifications` collection is exclusively accessible to admins, ensuring that sensitive ID verification data is protected from unauthorized access.  The admin role is verified by checking for the existence of a document in `/admins/{adminId}` collection.\n\n**Invariants:** The structure supports data integrity by using explicit timestamps (`createdAt`, `expiresAt`) and a dedicated `status` field for posts, enabling consistent state management. Ownership is enforced through the `postedBy` field in posts and `repliedBy` in replies, ensuring that users can only modify their own content.\n\nThis structure balances security and performance, providing a solid foundation for the CampusFind application."
  }
}